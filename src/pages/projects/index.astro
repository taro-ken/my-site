---
import Base from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import ProjectCard from "../../components/ProjectCard.astro";
import { getCollection } from "astro:content";

const items = (await getCollection("projects")).sort((a,b) =>
  (b.data.featured === a.data.featured) ? 0 : (b.data.featured ? 1 : -1)
);
const allTags = Array.from(new Set(items.flatMap(p => p.data.tags))).sort();
---
<Base title="Portfolio | KENTARO">
  <Header />
  <main class="mx-auto max-w-5xl px-4 py-10">
    <h1 class="text-2xl font-bold mb-4">Portfolio</h1>

    <!-- フィルタ -->
    <div id="filters" class="flex flex-wrap gap-2 mb-6 text-sm">
      <button class="filter active rounded-full border px-3 py-1" data-tag="all">All</button>
      {allTags.map(t => <button class="filter rounded-full border px-3 py-1" data-tag={t}>{t}</button>)}
    </div>

    <div id="grid" class="grid gap-6 sm:grid-cols-2">
      {items.map(p => (
        <div class="proj" data-tags={p.data.tags.join(",")}>
          <ProjectCard {...p.data} />
        </div>
      ))}
    </div>
  </main>

  <!-- 超軽量フィルタ（バニラJS） -->
  <script is:inline>
    const btns = document.querySelectorAll('#filters .filter');
    const cards = document.querySelectorAll('#grid .proj');
    btns.forEach(b => b.addEventListener('click', () => {
      btns.forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      const tag = b.dataset.tag;
      cards.forEach(c => {
        const tags = (c.dataset.tags || "").split(",");
        c.style.display = (tag === 'all' || tags.includes(tag)) ? '' : 'none';
      });
    }));
  </script>
  <style is:global>
    #filters .active { background: black; color: white; }
  </style>
</Base>

